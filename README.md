# Maze: é¢å‘å¤§è¯­è¨€æ¨¡å‹ä»£ç†çš„åˆ†å¸ƒå¼æ¡†æ¶

`Maze` æ˜¯ä¸€ä¸ªä¸“ä¸ºå¤§è¯­è¨€æ¨¡å‹ï¼ˆ`LLM`ï¼‰ä»£ç†åº”ç”¨è®¾è®¡çš„åˆ†å¸ƒå¼æ‰§è¡Œæ¡†æ¶ã€‚éšç€`LLM Agent`èƒ½åŠ›çš„æ—¥ç›Šå¼ºå¤§ï¼Œå°†å…¶éƒ¨ç½²åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ä»¥æ»¡è¶³é«˜å¹¶å‘éœ€æ±‚å˜å¾—è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œç°æœ‰çš„ä»£ç†æ¡†æ¶æ™®éé‡‡ç”¨å°†æ•´ä¸ª`Agent`ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œè°ƒåº¦çš„â€œä»£ç†çº§éƒ¨ç½²â€æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å¾€å¾€ä¼šå¯¼è‡´ä¸¥é‡çš„è®¡ç®—èµ„æºç“¶é¢ˆå’Œè´Ÿè½½ä¸å‡è¡¡é—®é¢˜ã€‚

ä¸ºäº†è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œ`Maze`åˆ›æ–°æ€§åœ°æå‡ºäº†**ä»»åŠ¡çº§ï¼ˆtask-levelï¼‰éƒ¨ç½²**æ¶æ„ã€‚å®ƒå°†å¤æ‚çš„`Agent`å·¥ä½œæµåˆ†è§£ä¸ºä¸€ç³»åˆ—ç‹¬ç«‹çš„ã€ç»†ç²’åº¦çš„ä»»åŠ¡ï¼ˆ`Task`ï¼‰ï¼Œç”±ä¸€ä¸ªå…·å¤‡é¢„æµ‹èƒ½åŠ›çš„ã€æ„ŸçŸ¥ä¾èµ–å…³ç³»çš„ä¸­å¤®è°ƒåº¦å™¨ï¼ŒåŠ¨æ€åœ°åˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸åŒè®¡ç®—èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚è¿™ç§è®¾è®¡ä»æ ¹æœ¬ä¸Šè§£å†³äº†å¼‚æ„ä»»åŠ¡ä¸‹çš„èµ„æºäº‰æŠ¢é—®é¢˜ï¼Œå®ç°äº†é«˜æ•ˆçš„è´Ÿè½½å‡è¡¡ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„æ•´ä½“ååé‡å’Œå¯æ‰©å±•æ€§ã€‚

## Mazeæ¡†æ¶

### ç³»ç»Ÿæ¶æ„

`Maze`é‡‡ç”¨äº†æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡ï¼Œç”±å››ä¸ªæ ¸å¿ƒç»„ä»¶ååŒå·¥ä½œï¼Œä»¥å®ç°é«˜æ•ˆã€å¯æ‰©å±•çš„åˆ†å¸ƒå¼`Agent`å·¥ä½œæµç®¡ç†ã€‚

- **MaRegister (æ³¨å†Œæ¨¡å—)**: è´Ÿè´£å®šä¹‰`Agent`çš„å·¥ä½œæµã€‚ç”¨æˆ·é€šè¿‡`Python API`å°†ä»»åŠ¡å‡½æ•°ï¼ˆ`Task`ï¼‰æ³¨å†Œåˆ°è®¡ç®—å›¾ä¸­ï¼Œå¹¶æŒ‡å®šå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ˆ`DAG`ï¼‰ã€‚
- **MaLearn (å­¦ä¹ æ¨¡å—)**: ä¸€ä¸ªåœ¨çº¿å­¦ä¹ æ¨¡å‹ï¼Œèƒ½å¤Ÿæ ¹æ®å†å²æ•°æ®é¢„æµ‹ä»»åŠ¡çš„æ‰§è¡Œå¤æ‚åº¦ï¼ˆå¦‚æ‰§è¡Œæ—¶é—´ï¼‰ï¼Œä¸ºè°ƒåº¦å™¨æä¾›æ›´æ™ºèƒ½çš„å†³ç­–ä¾æ®ã€‚
- **MaPath (è·¯å¾„/è°ƒåº¦æ¨¡å—)**: æ¡†æ¶çš„æ™ºèƒ½æ ¸å¿ƒï¼Œå®ƒå®ç°äº†`DAPS`ï¼ˆ`DAG-Aware Predictive Scheduling`ï¼‰è°ƒåº¦ç®—æ³•ã€‚`MaPath`æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€ä¾èµ–å…³ç³»ã€èµ„æºéœ€æ±‚å’Œæ•°æ®äº²å’Œæ€§ï¼Œå†³å®šå°†ä»»åŠ¡æ”¾ç½®åˆ°å“ªä¸ªè®¡ç®—èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚
- **MaWorker (å·¥ä½œæ¨¡å—)**: éƒ¨ç½²åœ¨é›†ç¾¤ä¸­æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ä¸Šçš„æ‰§è¡Œå¼•æ“ã€‚å®ƒæ¥æ”¶æ¥è‡ª`MaPath`çš„è°ƒåº¦æŒ‡ä»¤ï¼Œè´Ÿè´£ä»»åŠ¡çš„å®é™…æ‰§è¡Œã€ç¯å¢ƒç®¡ç†å’ŒçŠ¶æ€å›æŠ¥ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

ğŸ’¡ **é«˜æ•ˆçš„è´Ÿè½½å‡è¡¡** `Maze`çš„æ ¸å¿ƒæ˜¯å…¶**é¢å‘å¼‚æ„ä»»åŠ¡çš„ä»»åŠ¡çº§è°ƒåº¦**èƒ½åŠ›ã€‚ä¸åŒäºä¼ ç»Ÿæ¡†æ¶å°†æ•´ä¸ª`Agent`ç»‘å®šåˆ°å•ä¸€èŠ‚ç‚¹ï¼Œ`Maze`å°†å·¥ä½œæµåˆ†è§£ä¸ºç‹¬ç«‹çš„`CPU`å¯†é›†å‹ã€`GPU`å¯†é›†å‹å’Œ`I/O`å¯†é›†å‹ä»»åŠ¡ã€‚è°ƒåº¦å™¨èƒ½å¤Ÿæ„ŸçŸ¥æ¯ä¸ªä»»åŠ¡çš„èµ„æºéœ€æ±‚å’Œæ¯ä¸ªèŠ‚ç‚¹çš„å®æ—¶è´Ÿè½½ï¼Œè¿›è¡Œç²¾ç»†åŒ–çš„åŠ¨æ€åˆ†é…ã€‚è¿™ä¸ä»…æ‰“ç ´äº†â€œä»£ç†çº§éƒ¨ç½²â€çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ›´ç¡®ä¿äº†é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„è®¡ç®—èµ„æºéƒ½å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚

ğŸš€ **å¼ºå¤§çš„å¯æ‰©å±•æ€§** `Maze`çš„æ¶æ„ä¸ºå¤§è§„æ¨¡éƒ¨ç½²è€Œè®¾è®¡ã€‚é€šè¿‡é«˜æ•ˆçš„ä»»åŠ¡åˆ†å‘å’Œå»ä¸­å¿ƒåŒ–çš„æ‰§è¡Œæ¨¡å‹ï¼Œç³»ç»Ÿèƒ½å¤Ÿéšç€è®¡ç®—èŠ‚ç‚¹çš„å¢åŠ å®ç°**è¿‘çº¿æ€§çš„æ€§èƒ½æå‡**ã€‚è¿™æ„å‘³ç€å½“ä¸šåŠ¡éœ€æ±‚å¢é•¿æ—¶ï¼Œæ‚¨åªéœ€å‘é›†ç¾¤ä¸­æ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå³å¯è½»æ¾è·å¾—æ›´é«˜çš„å¤„ç†èƒ½åŠ›ï¼Œè€Œæ— éœ€å¯¹åº”ç”¨æœ¬èº«è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚

ğŸ **å“è¶Šçš„æ˜“ç”¨æ€§** æˆ‘ä»¬è‡´åŠ›äºæä¾›æœ€ç®€æ´çš„ç”¨æˆ·ä½“éªŒã€‚

- **å®‰è£…ç®€å•**ï¼šé€šè¿‡`pip`å³å¯å®Œæˆæ¡†æ¶çš„å®‰è£…ï¼Œæ— éœ€å¤æ‚çš„ç¯å¢ƒé…ç½®ã€‚
- **ä½¿ç”¨ç®€å•**ï¼šç”¨æˆ·æ— éœ€æˆä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸“å®¶ã€‚é€šè¿‡ç›´è§‚çš„`DAGAgent API`å’Œæ ‡å‡†çš„`Python`å‡½æ•°è£…é¥°å™¨`@tool`ï¼Œæ‚¨å¯ä»¥åƒç¼–å†™å•æœºç¨‹åºä¸€æ ·å®šä¹‰å’Œç¼–æ’å¤æ‚çš„åˆ†å¸ƒå¼å·¥ä½œæµã€‚`Maze`æ¡†æ¶ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰åº•å±‚çš„ä»»åŠ¡åºåˆ—åŒ–ã€ä»£ç åˆ†å‘ã€ä¾èµ–ç®¡ç†å’Œè¿œç¨‹æ‰§è¡Œã€‚

## å®Œæ•´å®‰è£…ä¸éƒ¨ç½²æµç¨‹

### ç¯å¢ƒå‡†å¤‡

1. **è·å–ä»£ç **:

   ```
   git clone [https://github.com/tianming-x/Maze.git](https://github.com/tianming-x/Maze.git)
   cd Maze
   ```

2. **å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–**: åœ¨ä¸€ä¸ªå¹²å‡€çš„`Python`è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æ‰€æœ‰å¿…éœ€çš„ç¬¬ä¸‰æ–¹åº“ã€‚

   ```
   pip install -r requirements.txt
   ```

3. **å®‰è£…é¡¹ç›®æœ¬èº«å¹¶æ³¨å†Œå‘½ä»¤**: æ¥ç€ï¼Œè¿è¡Œæ­¤å‘½ä»¤å°† `maze` é¡¹ç›®ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åˆ°æ‚¨çš„ç¯å¢ƒä¸­ï¼Œè¿™åŒæ—¶ä¹Ÿä¼šæ³¨å†Œæˆ‘ä»¬æä¾›çš„ `maze` å‘½ä»¤è¡Œå·¥å…·ã€‚

   ```
   pip install -e .
   ```

4. **é…ç½®æ–‡ä»¶**: **[â—æå…¶é‡è¦]** åœ¨å¯åŠ¨**æœåŠ¡å™¨æ¨¡å¼**å‰ï¼Œè¯·åŠ¡å¿…æ‰“å¼€ `config/config.toml` æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹ `[paths]` éƒ¨åˆ†ä¸‹çš„ `project_root`ï¼Œå°†å…¶è®¾ç½®ä¸ºæ‚¨æœ¬åœ° `Maze` é¡¹ç›®çš„**ç»å¯¹è·¯å¾„**ã€‚`Ray`é›†ç¾¤çš„ `runtime_env` éœ€è¦è¿™ä¸ªè·¯å¾„æ¥å°†ä»£ç æ­£ç¡®åœ°åˆ†å‘åˆ°æ‰€æœ‰ä»èŠ‚ç‚¹ï¼ˆ`Worker Nodes`ï¼‰ã€‚

   ```
   # ç¤ºä¾‹:
   project_root = "/path/to/your/Maze"
   ```

5. **ä¸‹è½½æ¨¡å‹ (å¯é€‰)**: å¦‚æœæ‚¨å¸Œæœ›è¿è¡Œå†…ç½®çš„ã€ä¾èµ–ç‰¹å®šæœ¬åœ°æ¨¡å‹çš„ç¤ºä¾‹å·¥ä½œæµï¼Œè¯·è¿è¡Œä»¥ä¸‹è„šæœ¬ä¸‹è½½æ‰€éœ€çš„æ¨¡å‹æ–‡ä»¶åˆ° `model_cache` ç›®å½•ã€‚

   ```
   python maze/utils/download_model.py
   ```

### è¿è¡Œæ¨¡å¼è¯´æ˜

`Maze`æ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œé€šè¿‡ `agent.submit()` æ–¹æ³•çš„ `mode` å‚æ•°è¿›è¡Œåˆ‡æ¢ã€‚

#### æœ¬åœ°æ¨¡å¼ (Local Mode)

æ­¤æ¨¡å¼ä¸»è¦ç”¨äº**å¼€å‘å’Œè°ƒè¯•**å·¥ä½œæµï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **æ— éœ€**å¯åŠ¨ `main.py` ä¸­å¿ƒæœåŠ¡ï¼Œä¹Ÿ**æ— éœ€**éƒ¨ç½²`Ray`é›†ç¾¤ã€‚
- å·¥ä½œæµå°†åœ¨æ‚¨ç¼–å†™å’Œè¿è¡Œä»£ç çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œä»¥ä¸€ä¸ªç‹¬ç«‹çš„åå°çº¿ç¨‹æ‰§è¡Œã€‚
- é€‚åˆå¿«é€ŸéªŒè¯`DAG`å›¾çš„é€»è¾‘æ­£ç¡®æ€§å’Œå•ä¸ªä»»åŠ¡å‡½æ•°çš„åŠŸèƒ½ã€‚
- **è°ƒç”¨æ–¹æ³•**: `agent.submit(mode='local')`

#### æœåŠ¡å™¨æ¨¡å¼ (Server Mode) - åˆ†å¸ƒå¼æ‰§è¡Œ

æ­¤æ¨¡å¼ç”¨äºç”Ÿäº§ç¯å¢ƒä¸‹çš„åˆ†å¸ƒå¼ã€å¯æ‰©å±•æ‰§è¡Œã€‚

- **æ­¥éª¤1: é…ç½®å¹¶å¯åŠ¨ä¸­å¿ƒèŠ‚ç‚¹ (Master Node)**

  1. æŒ‰ç…§ä¸Šæ–‡â€œé…ç½®è¯´æ˜â€ä¿®æ”¹ `config/config.toml` æ–‡ä»¶ã€‚

  2. åœ¨ä¸­å¿ƒèŠ‚ç‚¹ä¸Šå¯åŠ¨Mazeçš„ä¸­å¿ƒæœåŠ¡ã€‚è¿™ä¸€ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨å®Œæˆ`Ray Head`æœåŠ¡çš„å¯åŠ¨å’Œ`Maze`è°ƒåº¦æœåŠ¡çš„è¿è¡Œï¼š

     ```
     maze start --head
     ```

- **æ­¥éª¤2: å¯åŠ¨ä»èŠ‚ç‚¹ (Worker Nodes)**

  1. åœ¨æ¯ä¸€ä¸ªä»èŠ‚ç‚¹ä¸Šï¼Œç¡®ä¿å·²å®‰è£…`Ray`å’Œé¡¹ç›®ä¾èµ–ã€‚

  2. è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†ä»èŠ‚ç‚¹åŠ å…¥åˆ°Rayé›†ç¾¤ä¸­ã€‚æ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ä»é…ç½®æ–‡ä»¶è¯»å–ä¸»èŠ‚ç‚¹åœ°å€ï¼š

     ```
     maze start --worker
     ```

- **æ­¥éª¤3: å®¢æˆ·ç«¯æäº¤å·¥ä½œæµ** åœ¨ä»»æ„ä¸€å°é…ç½®å¥½é¡¹ç›®ç¯å¢ƒçš„æœºå™¨ä¸Šï¼ˆå¯ä»¥æ˜¯ä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦å¤–çš„å®¢æˆ·æœºï¼‰ï¼Œç¼–å†™å¹¶è¿è¡Œå®¢æˆ·ç«¯è„šæœ¬ï¼ˆå¦‚ä¸‹æ–¹`Demo`æ‰€ç¤ºï¼‰ï¼Œé€šè¿‡ `agent.submit(mode='server')` æäº¤ä»»åŠ¡ã€‚

## å¿«é€Ÿä¸Šæ‰‹ï¼šä¸€ä¸ªå®Œæ•´çš„Demo

æœ¬èŠ‚å°†é€šè¿‡ä¸€ä¸ªåˆ›å»ºæŠ¥å‘Šçš„å®ä¾‹ï¼Œå®Œæ•´æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨`Maze`å®šä¹‰å¹¶æ‰§è¡Œä¸€ä¸ªåˆ†å¸ƒå¼å·¥ä½œæµã€‚

### ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ä»»åŠ¡å‡½æ•° (Task Functions)

`Maze`ä¸­çš„æ¯ä¸€ä¸ªè®¡ç®—æ­¥éª¤éƒ½æ˜¯ä¸€ä¸ª**ä»»åŠ¡ï¼ˆTaskï¼‰**ï¼Œå®ƒç”±ä¸€ä¸ªæ™®é€šçš„`Python`å‡½æ•°å’Œä¸€ä¸ª`@tool`è£…é¥°å™¨å®šä¹‰ã€‚`@tool`è£…é¥°å™¨æ˜¯å…³é”®ï¼Œå®ƒå‘`Maze`ç³»ç»Ÿå£°æ˜äº†ä»»åŠ¡çš„å…ƒæ•°æ®ï¼Œå¦‚åç§°ã€æè¿°ã€èµ„æºéœ€æ±‚ä»¥åŠè¾“å…¥è¾“å‡ºæ ¼å¼ã€‚

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º`demo.py`çš„æ–‡ä»¶æ¥å­˜æ”¾æˆ‘ä»¬çš„ä»»åŠ¡å‡½æ•°ï¼š

```python
# demo.py
import time
from maze.library.tools.definitions import tool

@tool(
    name="create_initial_report",
    description="åˆ›å»ºä¸€ä¸ªåˆå§‹æŠ¥å‘Šï¼Œä½œä¸ºå·¥ä½œæµçš„èµ·ç‚¹ã€‚",
    task_type='cpu',
    input_parameters={"properties": {"reporter_name": {"type": "string"}}},
    output_parameters={"properties": {"report_content": {"type": "string"}}}
)
def create_report(reporter_name: str) -> str:
    print(f"--- ä»»åŠ¡ [create_initial_report] æ­£åœ¨æ‰§è¡Œ ---")
    report = f"Initial report generated by {reporter_name}."
    print(f"--- ä»»åŠ¡ [create_initial_report] å®Œæˆ ---")
    return report

@tool(
    name="add_analysis_section",
    description="åœ¨æŠ¥å‘Šä¸­æ·»åŠ åˆ†æç« èŠ‚ã€‚",
    task_type='cpu',
    input_parameters={"properties": {"base_report": {"type": "string"}}},
    output_parameters={"properties": {"updated_report": {"type": "string"}}}
)
def add_analysis(base_report: str) -> str:
    print(f"--- ä»»åŠ¡ [add_analysis_section] æ­£åœ¨æ‰§è¡Œ ---")
    time.sleep(2) # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    updated_report = base_report + "\nSection: Data Analysis - Analysis complete."
    print(f"--- ä»»åŠ¡ [add_analysis_section] å®Œæˆ ---")
    return updated_report

@tool(
    name="add_summary_section",
    description="åœ¨æŠ¥å‘Šä¸­æ·»åŠ æ€»ç»“ç« èŠ‚ã€‚",
    task_type='cpu',
    input_parameters={"properties": {"base_report": {"type": "string"}}},
    output_parameters={"properties": {"updated_report": {"type": "string"}}}
)
def add_summary(base_report: str) -> str:
    print(f"--- ä»»åŠ¡ [add_summary_section] æ­£åœ¨æ‰§è¡Œ ---")
    time.sleep(3) # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    updated_report = base_report + "\nSection: Summary - Summary complete."
    print(f"--- ä»»åŠ¡ [add_summary_section] å®Œæˆ ---")
    return updated_report

@tool(
    name="finalize_report",
    description="æ•´åˆæ‰€æœ‰ç« èŠ‚ï¼Œå½¢æˆæœ€ç»ˆæŠ¥å‘Šã€‚",
    task_type='cpu',
    input_parameters={"properties": {"analysis_report": {"type": "string"}, "summary_report": {"type": "string"}}},
    output_parameters={"properties": {"final_report": {"type": "string"}}}
)
def finalize_report(analysis_report: str, summary_report: str) -> str:
    print(f"--- ä»»åŠ¡ [finalize_report] æ­£åœ¨æ‰§è¡Œ ---")
    final_report = f"--- FINAL REPORT ---\n{analysis_report}\n{summary_report.splitlines()[-1]}"
    print(f"--- ä»»åŠ¡ [finalize_report] å®Œæˆ ---")
    return final_report
```

### ç¬¬äºŒæ­¥ï¼šç¼–å†™å®¢æˆ·ç«¯è„šæœ¬ï¼Œç¼–æ’å¹¶æ‰§è¡Œå·¥ä½œæµ

ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`client.py`è„šæœ¬æ¥ç»„ç»‡è¿™äº›ä»»åŠ¡ï¼Œå®šä¹‰å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶å°†æ•´ä¸ªå·¥ä½œæµæäº¤åˆ°Mazeé›†ç¾¤ã€‚

#### **å®šä¹‰ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»**

`Maze`é€šè¿‡ä¸€ç§ç‰¹æ®Šçš„**f-string**è¯­æ³•æ¥å£°æ˜ä»»åŠ¡é—´çš„ä¾èµ–ã€‚å½“ä¸€ä¸ªä»»åŠ¡çš„è¾“å…¥ï¼ˆ`inputs`ï¼‰éœ€è¦ä¾èµ–ä¸Šæ¸¸ä»»åŠ¡çš„è¾“å‡ºæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ¼å¼çš„å­—ç¬¦ä¸²ï¼š

```
f"{task_id}.output.{output_key}"
```

- `task_id`: æ˜¯ä¸Šæ¸¸ä»»åŠ¡åœ¨`agent.add_task()`æ—¶è¿”å›çš„å”¯ä¸€IDã€‚
- `output`: æ˜¯ä¸€ä¸ªå›ºå®šå…³é”®å­—ã€‚
- `output_key`: æ˜¯ä¸Šæ¸¸ä»»åŠ¡`@tool`è£…é¥°å™¨ä¸­`output_parameters`é‡Œå®šä¹‰çš„è¾“å‡ºå‚æ•°åã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´çš„å®¢æˆ·ç«¯ä»£ç ï¼š

```python
import time
from maze.agent.dag_agent import DAGAgent
from demo import create_report, add_analysis, add_summary, finalize_report

# 1. åˆå§‹åŒ–Agentï¼Œå¹¶æŒ‡å®šä¸­å¿ƒæœåŠ¡çš„åœ°å€ (è¯·æ›¿æ¢ä¸ºæ‚¨çš„Master Node IP)
agent = DAGAgent(name="Custom Task Workflow", root_path=".", scheduler_addr="master node ip:port")

# 2. åŠ¨æ€æ³¨å†Œä»»åŠ¡å‡½æ•°
print("ğŸš€ [æ­¥éª¤ 1] åŠ¨æ€æ³¨å†Œè‡ªå®šä¹‰ä»»åŠ¡...")
agent.register_task(create_report)
agent.register_task(add_analysis)
agent.register_task(add_summary)
agent.register_task(finalize_report)
print("âœ… [æ­¥éª¤ 1] æ‰€æœ‰è‡ªå®šä¹‰ä»»åŠ¡å·²æ³¨å†Œã€‚\n")

# 3. æ„å»ºå·¥ä½œæµï¼ˆDAGï¼‰ï¼Œå¹¶å®šä¹‰ä¾èµ–å…³ç³»
print("ğŸš€ [æ­¥éª¤ 2] æ„å»ºå·¥ä½œæµ...")
#       /--> add_analysis --\
# create_report             --> finalize_report
#       \--> add_summary ---/
task_a_id = agent.add_task(create_report, inputs={"reporter_name": "MazeTest"})

# task_b å’Œ task_c å¹¶è¡Œæ‰§è¡Œï¼Œå®ƒä»¬éƒ½ä¾èµ–äº task_a çš„è¾“å‡º
task_b_id = agent.add_task(add_analysis, inputs={"base_report": f"{task_a_id}.output.report_content"})
task_c_id = agent.add_task(add_summary, inputs={"base_report": f"{task_a_id}.output.report_content"})

# task_d ä¾èµ–äº task_b å’Œ task_c çš„å®Œæˆ
task_d_id = agent.add_task(
    finalize_report, 
    inputs={
        "analysis_report": f"{task_b_id}.output.updated_report",
        "summary_report": f"{task_c_id}.output.updated_report"
    }
)
print("âœ… [æ­¥éª¤ 2] å·¥ä½œæµæ„å»ºæˆåŠŸã€‚\n")

# å¯é€‰ï¼šå¯è§†åŒ–DAGå›¾ï¼Œåœ¨Jupyter Notebookç­‰ç¯å¢ƒä¸­ä¼šè‡ªåŠ¨æ˜¾ç¤º
# agent.visualize()

# 4. æäº¤å·¥ä½œæµåˆ°æœåŠ¡å™¨æ‰§è¡Œ
print("ğŸš€ [æ­¥éª¤ 3] æäº¤å·¥ä½œæµåˆ°æœåŠ¡å™¨...")
result = agent.submit(mode="server")
run_id = result.get('run_id')
print(f"âœ… [æ­¥éª¤ 3] å·¥ä½œæµå·²æäº¤ã€‚è¿è¡ŒID: {run_id}\n")

# 5. è½®è¯¢ç­‰å¾…æœ€ç»ˆä»»åŠ¡å®Œæˆ
print("ğŸš€ [æ­¥éª¤ 4] è½®è¯¢ç­‰å¾…æœ€ç»ˆç»“æœ...")
final_task_id = task_d_id
while True:
    time.sleep(1)
    result_info = agent.get(final_task_id, run_id)
    task_status = result_info.get("task_status")
    print(f"  -> è½®è¯¢ä¸­... æœ€ç»ˆä»»åŠ¡ '{final_task_id}' çš„çŠ¶æ€: {task_status}")
    if task_status == "finished":
        print("\nâœ… [æ­¥éª¤ 4] æœ€ç»ˆä»»åŠ¡å·²å®Œæˆ!")
        print("æœ€ç»ˆæŠ¥å‘Šå†…å®¹:")
        print(result_info)
        break
    elif task_status == "failed":
        print(f"\nâŒ [æ­¥éª¤ 4] ä»»åŠ¡å¤±è´¥! é”™è¯¯: {result_info.get('error')}")
        break

# 6. æ˜¾ç¤ºæ‰§è¡Œæ‘˜è¦
print("\nğŸš€ [æ­¥éª¤ 5] æ˜¾ç¤ºæ‰§è¡Œæ‘˜è¦...")
agent.display_summary(run_id)

# 7. æ¸…ç†é›†ç¾¤ä¸Šçš„èµ„æº
print("\nğŸš€ [æ­¥éª¤ 6] æ¸…ç†é›†ç¾¤èµ„æº...")
agent.destroy(run_id)
print("âœ… [æ­¥éª¤ 6] æ¸…ç†å®Œæˆã€‚")
```

### é¢„æœŸè¾“å‡º

å½“æ‚¨åœ¨é…ç½®å¥½æœåŠ¡å™¨æ¨¡å¼çš„ç¯å¢ƒä¸­è¿è¡Œ`client.py`åï¼Œæ‚¨å°†åœ¨ç»ˆç«¯çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š

```
ğŸš€ [æ­¥éª¤ 1] åŠ¨æ€æ³¨å†Œè‡ªå®šä¹‰ä»»åŠ¡...
âœ… [æ­¥éª¤ 1] æ‰€æœ‰è‡ªå®šä¹‰ä»»åŠ¡å·²æ³¨å†Œã€‚

ğŸš€ [æ­¥éª¤ 2] æ„å»ºå·¥ä½œæµ...
âœ… [æ­¥éª¤ 2] å·¥ä½œæµæ„å»ºæˆåŠŸã€‚

ğŸš€ [æ­¥éª¤ 3] æäº¤å·¥ä½œæµåˆ°æœåŠ¡å™¨...
âœ… [æ­¥éª¤ 3] å·¥ä½œæµå·²æäº¤ã€‚è¿è¡ŒID: 4c425cf8-ff5b-4368-8ca3-702a7b4e872e

ğŸš€ [æ­¥éª¤ 4] è½®è¯¢ç­‰å¾…æœ€ç»ˆç»“æœ...
  -> è½®è¯¢ä¸­... æœ€ç»ˆä»»åŠ¡ 'task_72dca8d9' çš„çŠ¶æ€: received
  ...
  -> è½®è¯¢ä¸­... æœ€ç»ˆä»»åŠ¡ 'task_72dca8d9' çš„çŠ¶æ€: finished

âœ… [æ­¥éª¤ 4] æœ€ç»ˆä»»åŠ¡å·²å®Œæˆ!
æœ€ç»ˆæŠ¥å‘Šå†…å®¹:
{'data': {'final_report': '--- FINAL REPORT ---\nInitial report generated by MazeTest.\nSection: Data Analysis - Analysis complete.\nSection: Summary - Summary complete.'}, 'status': 'success', 'task_status': 'finished'}

ğŸš€ [æ­¥éª¤ 5] æ˜¾ç¤ºæ‰§è¡Œæ‘˜è¦...
+-----------------------+-----------------+------------+-----------------+
| Task Name             | Task ID         | Status     | Duration (s)    |
+-----------------------+-----------------+------------+-----------------+
| create_initial_report | task_92853843   | finished   | 0.08            |
| add_analysis_section  | task_479e948b   | finished   | 2.05            |
| add_summary_section   | task_35e4f792   | finished   | 3.06            |
| finalize_report       | task_72dca8d9   | finished   | 0.05            |
+-----------------------+-----------------+------------+-----------------+
| Total Workflow Duration: 18.45s
+------------------------------------------------------------------------+

ğŸš€ [æ­¥éª¤ 6] æ¸…ç†é›†ç¾¤èµ„æº...
âœ… [æ­¥éª¤ 6] æ¸…ç†å®Œæˆã€‚
```

## APIæ ¸å¿ƒæ¥å£å‚è€ƒ

ä¸Mazeæ¡†æ¶çš„æ ¸å¿ƒäº¤äº’æ˜¯é€šè¿‡`DAGAgent`ç±»æ¥å®Œæˆçš„ã€‚ä»¥ä¸‹æ˜¯è¯¥ç±»çš„ä¸»è¦å…¬å…±æ–¹æ³•ï¼š

| æ–¹æ³•å                                              | æè¿°                                                         |
| --------------------------------------------------- | ------------------------------------------------------------ |
| `agent = DAGAgent(name, root_path, scheduler_addr)` | åˆ›å»ºä¸€ä¸ªAgentå®ä¾‹ã€‚`name`ä¸ºå·¥ä½œæµå‘½åï¼Œ`root_path`æ˜¯é¡¹ç›®ä»£ç çš„æ ¹ç›®å½•ï¼Œ`scheduler_addr`æ˜¯ä¸­å¿ƒæœåŠ¡çš„åœ°å€ã€‚ |
| `task_id = agent.add_task(func, inputs, ...)`       | å‘å·¥ä½œæµä¸­æ·»åŠ ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ã€‚`func`æ˜¯è¢«`@tool`è£…é¥°çš„å‡½æ•°ï¼Œ`inputs`å­—å…¸å®šä¹‰äº†è¯¥ä»»åŠ¡çš„è¾“å…¥ä¾èµ–ã€‚è¿”å›ä»»åŠ¡çš„å”¯ä¸€IDã€‚ |
| `agent.remove_task(task_id)`                        | ä»å½“å‰å·¥ä½œæµå®šä¹‰ä¸­ç§»é™¤ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ã€‚                         |
| `result = agent.submit(mode)`                       | æäº¤å·¥ä½œæµæ‰§è¡Œã€‚`mode`å¯ä»¥æ˜¯`'local'`ï¼ˆæœ¬åœ°è°ƒè¯•ï¼‰æˆ–`'server'`ï¼ˆåˆ†å¸ƒå¼æ‰§è¡Œï¼‰ã€‚æˆåŠŸåè¿”å›åŒ…å«`run_id`çš„å­—å…¸ã€‚ |
| `status = agent.get(task_id, run_id)`               | è·å–æŒ‡å®šä»»åŠ¡çš„å½“å‰çŠ¶æ€å’Œç»“æœï¼ˆå¦‚æœå·²å®Œæˆï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªéé˜»å¡æ“ä½œã€‚ |
| `agent.display_summary(run_id)`                     | ä»¥è¡¨æ ¼å½¢å¼åœ¨æ§åˆ¶å°æ‰“å°æŒ‡å®šå·¥ä½œæµçš„æ‰§è¡Œæ‘˜è¦ï¼ŒåŒ…æ‹¬æ¯ä¸ªä»»åŠ¡çš„çŠ¶æ€å’Œè€—æ—¶ã€‚ |
| `path = agent.download_results(run_id)`             | ä»æœåŠ¡å™¨ä¸‹è½½æŒ‡å®šå·¥ä½œæµè¿è¡Œäº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶è¿”å›æœ¬åœ°ä¿å­˜è·¯å¾„ã€‚ |
| `ok = agent.destroy(run_id)`                        | è¯·æ±‚ä¸­å¿ƒæœåŠ¡æ¸…ç†ä¸æŒ‡å®š`run_id`ç›¸å…³çš„æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬ç£ç›˜ä¸Šçš„ä¸´æ—¶æ–‡ä»¶å’Œå†…å­˜ä¸­çš„çŠ¶æ€ã€‚ |
| `agent.visualize()`                                 | åœ¨Jupyter Notebookæˆ–Matplotlibæ”¯æŒçš„ç¯å¢ƒä¸­ï¼Œå¯è§†åŒ–å½“å‰å·¥ä½œæµçš„DAGç»“æ„ã€‚ |
| `agent.register_task(func)`                         | ä¸ºå½“å‰Agentä¼šè¯åŠ¨æ€æ³¨å†Œä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„ä»»åŠ¡å‡½æ•°ã€‚            |